---
title: Set Simulation
author: ~
date: '2021-09-07'
slug: set-simulation
categories: []
tags: []
type: ''
subtitle: ''
image: ''
---



<p>My son and I were playing the card game Set this weekend. It’s a fun pattern matching game, and if you don’t know the rules, they’re available online <a href="https://www.setgame.com/set/puzzle">here.</a> Basically you deal out 12 cards and look for a set of 3 cards that fit a certain pattern. Each time a set is removed, 3 more cards are dealt to return the number of face up cards to 12. As each set is removed, this happens 23 times until the remaining 69 cards are gone. The winner is the person who has discovered the most sets.</p>
<p>In the instructions it says that there are 33:1 odds of having a set that fits the criteria when 12 cards are face up, and about 2500:1 when 15 cards are face up. In this one game, we kept being unable to find a set among 12 cards. When this happened we dealt another 3 cards (to make 15) and were usually able to find a set right away. But we were definitely getting stuck more than 1 in 34 times.</p>
<p>I wanted to find out what is the probability of having a set among 12 cards (and 15 for that matter). To do this, of course, I turned to R.</p>
<div id="create-the-deck" class="section level1">
<h1>Create the Deck</h1>
<pre class="r"><code>a1 &lt;- rep(c(0,1,10), rep(27, 3))
a2 &lt;- rep(rep(c(0,1,10), rep(9, 3)), 3)
a3 &lt;- rep(rep(c(0,1,10), rep(3, 3)), 9)
a4 &lt;- rep(c(0,1,10), 27)

cards &lt;- data.frame(a1, a2, a3, a4)

# number of 3 card combinations in deck
81*80*79/3/2</code></pre>
<pre><code>## [1] 85320</code></pre>
<pre class="r"><code># number of 3 card combinations in 12 cards
12*11*10/3/2</code></pre>
<pre><code>## [1] 220</code></pre>
<pre class="r"><code>trio &lt;- cards[sample(1:81, 3), ]
colSums(trio)</code></pre>
<pre><code>## a1 a2 a3 a4 
##  1 21 10 11</code></pre>
<pre class="r"><code>trio_sum &lt;- colSums(trio)
test1 &lt;- function(x) x %in% c(0, 3, 11, 30)

sapply(trio_sum, test1)</code></pre>
<pre><code>##    a1    a2    a3    a4 
## FALSE FALSE FALSE  TRUE</code></pre>
<pre class="r"><code>all(sapply(trio_sum, test1))</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>is_set &lt;- function(trio_sum) all(sapply(trio_sum, test1))

# Draw 12 cards
set.seed(1)
deal &lt;- sample(1:81, 12)
deal # card numbers</code></pre>
<pre><code>##  [1] 68 39  1 34 43 14 59 51 21 54  7 37</code></pre>
<pre class="r"><code># Find all combinations of sets of 3
sets &lt;- combn(deal, 3, simplify = F)
sets </code></pre>
<pre><code>## [[1]]
## [1] 68 39  1
## 
## [[2]]
## [1] 68 39 34
## 
## [[3]]
## [1] 68 39 43
## 
## [[4]]
## [1] 68 39 14
## 
## [[5]]
## [1] 68 39 59
## 
## [[6]]
## [1] 68 39 51
## 
## [[7]]
## [1] 68 39 21
## 
## [[8]]
## [1] 68 39 54
## 
## [[9]]
## [1] 68 39  7
## 
## [[10]]
## [1] 68 39 37
## 
## [[11]]
## [1] 68  1 34
## 
## [[12]]
## [1] 68  1 43
## 
## [[13]]
## [1] 68  1 14
## 
## [[14]]
## [1] 68  1 59
## 
## [[15]]
## [1] 68  1 51
## 
## [[16]]
## [1] 68  1 21
## 
## [[17]]
## [1] 68  1 54
## 
## [[18]]
## [1] 68  1  7
## 
## [[19]]
## [1] 68  1 37
## 
## [[20]]
## [1] 68 34 43
## 
## [[21]]
## [1] 68 34 14
## 
## [[22]]
## [1] 68 34 59
## 
## [[23]]
## [1] 68 34 51
## 
## [[24]]
## [1] 68 34 21
## 
## [[25]]
## [1] 68 34 54
## 
## [[26]]
## [1] 68 34  7
## 
## [[27]]
## [1] 68 34 37
## 
## [[28]]
## [1] 68 43 14
## 
## [[29]]
## [1] 68 43 59
## 
## [[30]]
## [1] 68 43 51
## 
## [[31]]
## [1] 68 43 21
## 
## [[32]]
## [1] 68 43 54
## 
## [[33]]
## [1] 68 43  7
## 
## [[34]]
## [1] 68 43 37
## 
## [[35]]
## [1] 68 14 59
## 
## [[36]]
## [1] 68 14 51
## 
## [[37]]
## [1] 68 14 21
## 
## [[38]]
## [1] 68 14 54
## 
## [[39]]
## [1] 68 14  7
## 
## [[40]]
## [1] 68 14 37
## 
## [[41]]
## [1] 68 59 51
## 
## [[42]]
## [1] 68 59 21
## 
## [[43]]
## [1] 68 59 54
## 
## [[44]]
## [1] 68 59  7
## 
## [[45]]
## [1] 68 59 37
## 
## [[46]]
## [1] 68 51 21
## 
## [[47]]
## [1] 68 51 54
## 
## [[48]]
## [1] 68 51  7
## 
## [[49]]
## [1] 68 51 37
## 
## [[50]]
## [1] 68 21 54
## 
## [[51]]
## [1] 68 21  7
## 
## [[52]]
## [1] 68 21 37
## 
## [[53]]
## [1] 68 54  7
## 
## [[54]]
## [1] 68 54 37
## 
## [[55]]
## [1] 68  7 37
## 
## [[56]]
## [1] 39  1 34
## 
## [[57]]
## [1] 39  1 43
## 
## [[58]]
## [1] 39  1 14
## 
## [[59]]
## [1] 39  1 59
## 
## [[60]]
## [1] 39  1 51
## 
## [[61]]
## [1] 39  1 21
## 
## [[62]]
## [1] 39  1 54
## 
## [[63]]
## [1] 39  1  7
## 
## [[64]]
## [1] 39  1 37
## 
## [[65]]
## [1] 39 34 43
## 
## [[66]]
## [1] 39 34 14
## 
## [[67]]
## [1] 39 34 59
## 
## [[68]]
## [1] 39 34 51
## 
## [[69]]
## [1] 39 34 21
## 
## [[70]]
## [1] 39 34 54
## 
## [[71]]
## [1] 39 34  7
## 
## [[72]]
## [1] 39 34 37
## 
## [[73]]
## [1] 39 43 14
## 
## [[74]]
## [1] 39 43 59
## 
## [[75]]
## [1] 39 43 51
## 
## [[76]]
## [1] 39 43 21
## 
## [[77]]
## [1] 39 43 54
## 
## [[78]]
## [1] 39 43  7
## 
## [[79]]
## [1] 39 43 37
## 
## [[80]]
## [1] 39 14 59
## 
## [[81]]
## [1] 39 14 51
## 
## [[82]]
## [1] 39 14 21
## 
## [[83]]
## [1] 39 14 54
## 
## [[84]]
## [1] 39 14  7
## 
## [[85]]
## [1] 39 14 37
## 
## [[86]]
## [1] 39 59 51
## 
## [[87]]
## [1] 39 59 21
## 
## [[88]]
## [1] 39 59 54
## 
## [[89]]
## [1] 39 59  7
## 
## [[90]]
## [1] 39 59 37
## 
## [[91]]
## [1] 39 51 21
## 
## [[92]]
## [1] 39 51 54
## 
## [[93]]
## [1] 39 51  7
## 
## [[94]]
## [1] 39 51 37
## 
## [[95]]
## [1] 39 21 54
## 
## [[96]]
## [1] 39 21  7
## 
## [[97]]
## [1] 39 21 37
## 
## [[98]]
## [1] 39 54  7
## 
## [[99]]
## [1] 39 54 37
## 
## [[100]]
## [1] 39  7 37
## 
## [[101]]
## [1]  1 34 43
## 
## [[102]]
## [1]  1 34 14
## 
## [[103]]
## [1]  1 34 59
## 
## [[104]]
## [1]  1 34 51
## 
## [[105]]
## [1]  1 34 21
## 
## [[106]]
## [1]  1 34 54
## 
## [[107]]
## [1]  1 34  7
## 
## [[108]]
## [1]  1 34 37
## 
## [[109]]
## [1]  1 43 14
## 
## [[110]]
## [1]  1 43 59
## 
## [[111]]
## [1]  1 43 51
## 
## [[112]]
## [1]  1 43 21
## 
## [[113]]
## [1]  1 43 54
## 
## [[114]]
## [1]  1 43  7
## 
## [[115]]
## [1]  1 43 37
## 
## [[116]]
## [1]  1 14 59
## 
## [[117]]
## [1]  1 14 51
## 
## [[118]]
## [1]  1 14 21
## 
## [[119]]
## [1]  1 14 54
## 
## [[120]]
## [1]  1 14  7
## 
## [[121]]
## [1]  1 14 37
## 
## [[122]]
## [1]  1 59 51
## 
## [[123]]
## [1]  1 59 21
## 
## [[124]]
## [1]  1 59 54
## 
## [[125]]
## [1]  1 59  7
## 
## [[126]]
## [1]  1 59 37
## 
## [[127]]
## [1]  1 51 21
## 
## [[128]]
## [1]  1 51 54
## 
## [[129]]
## [1]  1 51  7
## 
## [[130]]
## [1]  1 51 37
## 
## [[131]]
## [1]  1 21 54
## 
## [[132]]
## [1]  1 21  7
## 
## [[133]]
## [1]  1 21 37
## 
## [[134]]
## [1]  1 54  7
## 
## [[135]]
## [1]  1 54 37
## 
## [[136]]
## [1]  1  7 37
## 
## [[137]]
## [1] 34 43 14
## 
## [[138]]
## [1] 34 43 59
## 
## [[139]]
## [1] 34 43 51
## 
## [[140]]
## [1] 34 43 21
## 
## [[141]]
## [1] 34 43 54
## 
## [[142]]
## [1] 34 43  7
## 
## [[143]]
## [1] 34 43 37
## 
## [[144]]
## [1] 34 14 59
## 
## [[145]]
## [1] 34 14 51
## 
## [[146]]
## [1] 34 14 21
## 
## [[147]]
## [1] 34 14 54
## 
## [[148]]
## [1] 34 14  7
## 
## [[149]]
## [1] 34 14 37
## 
## [[150]]
## [1] 34 59 51
## 
## [[151]]
## [1] 34 59 21
## 
## [[152]]
## [1] 34 59 54
## 
## [[153]]
## [1] 34 59  7
## 
## [[154]]
## [1] 34 59 37
## 
## [[155]]
## [1] 34 51 21
## 
## [[156]]
## [1] 34 51 54
## 
## [[157]]
## [1] 34 51  7
## 
## [[158]]
## [1] 34 51 37
## 
## [[159]]
## [1] 34 21 54
## 
## [[160]]
## [1] 34 21  7
## 
## [[161]]
## [1] 34 21 37
## 
## [[162]]
## [1] 34 54  7
## 
## [[163]]
## [1] 34 54 37
## 
## [[164]]
## [1] 34  7 37
## 
## [[165]]
## [1] 43 14 59
## 
## [[166]]
## [1] 43 14 51
## 
## [[167]]
## [1] 43 14 21
## 
## [[168]]
## [1] 43 14 54
## 
## [[169]]
## [1] 43 14  7
## 
## [[170]]
## [1] 43 14 37
## 
## [[171]]
## [1] 43 59 51
## 
## [[172]]
## [1] 43 59 21
## 
## [[173]]
## [1] 43 59 54
## 
## [[174]]
## [1] 43 59  7
## 
## [[175]]
## [1] 43 59 37
## 
## [[176]]
## [1] 43 51 21
## 
## [[177]]
## [1] 43 51 54
## 
## [[178]]
## [1] 43 51  7
## 
## [[179]]
## [1] 43 51 37
## 
## [[180]]
## [1] 43 21 54
## 
## [[181]]
## [1] 43 21  7
## 
## [[182]]
## [1] 43 21 37
## 
## [[183]]
## [1] 43 54  7
## 
## [[184]]
## [1] 43 54 37
## 
## [[185]]
## [1] 43  7 37
## 
## [[186]]
## [1] 14 59 51
## 
## [[187]]
## [1] 14 59 21
## 
## [[188]]
## [1] 14 59 54
## 
## [[189]]
## [1] 14 59  7
## 
## [[190]]
## [1] 14 59 37
## 
## [[191]]
## [1] 14 51 21
## 
## [[192]]
## [1] 14 51 54
## 
## [[193]]
## [1] 14 51  7
## 
## [[194]]
## [1] 14 51 37
## 
## [[195]]
## [1] 14 21 54
## 
## [[196]]
## [1] 14 21  7
## 
## [[197]]
## [1] 14 21 37
## 
## [[198]]
## [1] 14 54  7
## 
## [[199]]
## [1] 14 54 37
## 
## [[200]]
## [1] 14  7 37
## 
## [[201]]
## [1] 59 51 21
## 
## [[202]]
## [1] 59 51 54
## 
## [[203]]
## [1] 59 51  7
## 
## [[204]]
## [1] 59 51 37
## 
## [[205]]
## [1] 59 21 54
## 
## [[206]]
## [1] 59 21  7
## 
## [[207]]
## [1] 59 21 37
## 
## [[208]]
## [1] 59 54  7
## 
## [[209]]
## [1] 59 54 37
## 
## [[210]]
## [1] 59  7 37
## 
## [[211]]
## [1] 51 21 54
## 
## [[212]]
## [1] 51 21  7
## 
## [[213]]
## [1] 51 21 37
## 
## [[214]]
## [1] 51 54  7
## 
## [[215]]
## [1] 51 54 37
## 
## [[216]]
## [1] 51  7 37
## 
## [[217]]
## [1] 21 54  7
## 
## [[218]]
## [1] 21 54 37
## 
## [[219]]
## [1] 21  7 37
## 
## [[220]]
## [1] 54  7 37</code></pre>
<pre class="r"><code># Function that takes a set of 3 cards and determines if they form a true Set
test_set &lt;- function(set) {
  cards[set, ] |&gt; colSums() |&gt; is_set()
}

# We can apply the function to all the combinations in the cards dealt
sapply(sets, test_set)</code></pre>
<pre><code>##   [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [13] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE
##  [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [61] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [73] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [85] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [97] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [109] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [121] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [133] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [145] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [157] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [169] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [181] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [193] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [205] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [217] FALSE FALSE FALSE FALSE</code></pre>
<pre class="r"><code># In this draw of 12 cards we find that there are actually 4 Sets!
table(sapply(sets, test_set))</code></pre>
<pre><code>## 
## FALSE  TRUE 
##   216     4</code></pre>
<pre class="r"><code># The sets that fulfill the Set criteria are the following
which(sapply(sets, test_set) == TRUE)</code></pre>
<pre><code>## [1]  17  24 172 196</code></pre>
<pre class="r"><code># The card numbers in those sets are:
sets_true &lt;- sets[which(sapply(sets, test_set) == TRUE)]
sets_true # which sets fulfill the Set criteria</code></pre>
<pre><code>## [[1]]
## [1] 68  1 54
## 
## [[2]]
## [1] 68 34 21
## 
## [[3]]
## [1] 43 59 21
## 
## [[4]]
## [1] 14 21  7</code></pre>
<pre class="r"><code># The actual card attributes are:
lapply(sets_true, function(x) cards[unlist(x),])</code></pre>
<pre><code>## [[1]]
##    a1 a2 a3 a4
## 68 10  1  1  1
## 1   0  0  0  0
## 54  1 10 10 10
## 
## [[2]]
##    a1 a2 a3 a4
## 68 10  1  1  1
## 34  1  0 10  0
## 21  0 10  0 10
## 
## [[3]]
##    a1 a2 a3 a4
## 43  1  1 10  0
## 59 10  0  1  1
## 21  0 10  0 10
## 
## [[4]]
##    a1 a2 a3 a4
## 14  0  1  1  1
## 21  0 10  0 10
## 7   0  0 10  0</code></pre>
</div>
